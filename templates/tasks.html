{% extends "layout.html" %}
{% block title %}Вопросы{% endblock %}
{% block content %}
<script>

// сперва формы нет и мы вешаем обработчик на контйнер (который уже присутствует)


  function check_answer(el) {
    $.ajax({
          type: "POST",
          url: "/check_answer",
          data: jQuery(el).closest('form').serialize(),
          success: function(response){
              if (response == 'True'){
                jQuery(el).closest('.card').css({"backgroundColor":"#48c548"})
              }
              else{
                jQuery(el).closest('.card').css({"backgroundColor":"#ff7474"})
              }

              console.log(response);
          },
          error: function(error) {
              console.log(error);
          }
      });
  }
  function sort_by_topic(el){
    $.ajax({
      type: "POST",
      url: "/tasks_search",
      data: jQuery(el).closest('form').serialize(),
      success: function(response){
        alert("Кнопка работает " + response)
        console.log(response);    
      },
      error: function(error) {
      console.log(error);
      alert("Ошибка");
      }

    });
  }


  $(document).ready(function() {
    $(".card form").submit(function(e){
    e.preventDefault();
    });
  });
  
</script>
<h1>Вопросы</h1> 



<div class="row">
 
  <div class="col-md-6">
      <form method='POST'>
        <p>Поиск заданий по категории:</p>
        <div class="row">
          <div class="col-md-8">
            <select name="task_topic" id="" class="form-control">
              {% for topic in topics %}
                <option value="{{topic.id}}">{{ topic.name }}</option>
              {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <input type="submit" value="Найти задания" class="fill answer-btn btn btn-primary"> 
        </div>
        </div>
          
          
      </form>
  </div>
  
  <div class="col-md-6">
    <form method="POST" action="{{url_for('task_search')}}">
      <p>Поиск заданий по id:</p>
      <div class="row">
              <div class="col-md-8">     
                <input type="text" class="form-control" name="task_id">
              </div>
            <div class="col-md-4">
                <input type="submit" value="Найти задание" class="fill answer-btn btn btn-primary">
                
            </div>
      </div>
      
    </form>
  </div>
    


</div>





  {% for task in tasks %}
    <div class="card">
      <h2>№ {{loop.index}}        
                                  <a href="{{url_for('delete_task', task_id = task.id)}}"><img src="/static/images/delete.png" width="40" height="38"></a>
                                  <a href="{{url_for('edit_task', task_id = task.id)}}"><img src="/static/images/Edit.png" width="40" height="40"></a>
                                  <img src="/static/images/info_icon.png" width="32" height="32"></a>
                                  <a href="{{url_for('tasks', topic_id = task.topic.id)}}" style="color: rgb(0, 0, 0)">#{{ task.topic.id }}</a></h2>
        {{task['question']}}
        {% if task.photo == None %}
        {% else %}
        <img src="/static/images/{{task['photo']}}" class="task-img" width="400" height="400">
        {% endif %}
      <form method='POST' name="form-{{task.id}}">
      <div class="row">
        <div class="col-md-8">
          <input type="hidden" name="task_id" value="{{task.id}}">
        </div>
        <div class="col-md-2">
          <input type="value" class="answer-field form-control" name="answer">
        </div>
        <div class="col-md-2">
          <input type="button" value="Ответить" class=" answer-btn btn btn-primary" onclick=check_answer(this)>
        </div>
      </form>
      </div>
    </div>

    
  {% endfor %}


{% endblock %}